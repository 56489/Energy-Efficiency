---
title: "Capstone Project CKME 136"
author: 'Student: Walter Cios; Student ID 500791945'
output:
  word_document: default
  html_document: default
---


# Introduction
Building enclosures have become more energy efficient as energy codes have become more stringent in recent years, highlighting the importance of improvements such as better windows, orientation, or insulation. The heating and cooling load calculation is the first step of the HVAC design procedure. 
Heating and cooling load are used to right-size the HVAC equipment of a building. 

The scope of this project is to build a statistical model to predict the heating and cooling load and to select the best performing model that provides the highest accuracy.  The quantitative research will also investigate which variables are influencing the most the cooling efficiency and will explore the trade-offs between accuracy and interpretability of the model. Last, the energy efficiency impact when increasing the window area or house orientation will also be investigated as part of this study. 
This model and analysis will help HVAC equipment selection and prevent purchasing of oversized equipment.

#Dataset
The dataset analyzed is a public dataset, created by Angeliki Xifara & Athanasios
The data is a simulation of 768 residential seven person buildings, assumed to be in Athens, Greece and has eight input variables (surface area, wall area, roof area, orientation, glazing area.) and two output variables (heating and cooling load).
...

# Step 1: Data Cleaning and Preparation

- Load the package to read the raw data from Excel;
- load also ggplot2 for graphs; 
- load dplyr for applying transformations on the dataframes; 
- load package GGally to be used for plotting
- load package reshape 2 

```{r message = FALSE, warning = FALSE}
library(readxl)
library(ggplot2)
library(dplyr)
library(GGally)
library(reshape2)
```

### Loading the data 

After examining the original excel file, I noticed that only the first sheet had data, so I will only read
that from the file

```{r}
raw_data <- read_excel("./Data/ENB2012_data.xlsx", sheet = 1)
```

### Display structure of "raw_data"
I reviewed that all 768 observations are loaded

```{r}
str(raw_data)
```
### Check for NA in the whole dataset and found none 
....

```{r}
sum(sapply(raw_data, is.na))
```

As an alternative we could also have done an NA check per columns and as expected found none 

```{r}
sapply(raw_data, function(x) { sum(is.na(x)) })
```
### Change column name to real variable names 

....
```{r}
data <- raw_data
names(data) <- c("Relative Compactness", "Surface Area", "Wall Area", "Roof Area", "Overall Height",
                 "Orientation", "Glazing Area", "Glazing Area Distribution", "Heating Load", "Cooling Load")
```

## Converting categorical variables to factors

As per the dataset description the variable "Orientation" has only four values N,W,S,E 
The variable "Glazing Area Distribution"" has also the above and in addition "0" and "1"


```{r}
toCategorical <- Vectorize(function(column) {
  switch(as.character(column),
                      "0" = "No Glazing Area",
                      "1" = "Uniform",
                      "2" = "North",
                      "3" = "East",
                      "4" = "South",
                      "5" = "West",
                      NA)
})

data$`Glazing Area Distribution` <- as.factor(toCategorical(data$`Glazing Area Distribution`))
data$Orientation <- as.factor(toCategorical(data$Orientation))

data$`Glazing Area Distribution` <- relevel(data$`Glazing Area Distribution`, "No Glazing Area")
```

## Review again structure, this time for "data"

```{r}
summary(data)
```

From the summmary we can see that Orientation and Glazing Area Distribution, are qualitative-categorical variables, the other variables are quantitaive-continuous


# Step 2: Exploratory Data Analysis 

Split up categorical variables from the continuous ones, into a new dataframe "data_categorical and keep the continuos ones in "data_numerical"

```{r}
data_numeric <- select(data, -`Orientation`, -`Glazing Area Distribution`)
data_categorical <- select(data, `Orientation`, `Glazing Area Distribution`)
```

## Paired Scatterplots

I looked for a better display of plot and found the package "GGally" that is being used for scatterplots between all pairs of variables 

```{r fig.height=10, fig.width=10}
ggpairs(data_numeric)
```



## Outlier detection
Review if there are outliers by using boxplots.Going forward I will try to use only ggplot for all graphs to create an consistent view

Looking at the Excel Table "Variable Review for Analysis" that has the Min and Max, I decided to split the boxplots into three categories by cluster of data: small (values 0-1); medium (values >1-50); large (>50)

```{r}
small <-select (data_numeric,`Relative Compactness`,`Glazing Area`)

medium <-select (data_numeric,`Overall Height`,`Heating Load`,`Cooling Load`)

large <-select (data_numeric,`Surface Area`,`Roof Area`,`Wall Area`)
```

Creating boxplots for the grouped variables into small, medium and large

```{r message=F}
small_long <- melt(small)
ggplot(data=small_long, aes(x = variable, y = value)) +
  geom_boxplot(fill = "green", lwd = 1.2) +
  geom_jitter(height = 0, width = 0.4, shape = 18, color = "blue") +
  ggtitle("Boxplots of variables with small values") +
  xlab("Variable Name") +
  ylab("Values")
```
```{r message=F}
medium_long <- melt(medium)

ggplot(data=medium_long, aes(x = variable, y = value)) +
  geom_boxplot(fill = "green",lwd = 1.2) +
  geom_jitter(height = 0, width = 0.4, shape = 18, color = "blue") +
  ggtitle("Boxplots of variables with medium values") +
  xlab("Variable Name") +
  ylab("Values")
```

```{r message=F}
# Step 2 
large_long <- melt(large)

ggplot(data=large_long, aes(x = variable, y = value)) +
  geom_boxplot(fill = "green", lwd = 1.2) +
  geom_jitter(height = 0, width = 0.4, shape = 18, color = "blue") +
  ggtitle("Boxplots of variables with large values") +
  xlab("Variable Name") +
  ylab("Values")
```

```{r fig.height=8, fig.width=10}
correlationMatrix <- cor(data_numeric, method = "pearson")
correlationsLong <- melt(correlationMatrix)

ggplot(data = correlationsLong, aes(x = Var1, y = Var2)) +
  geom_tile(aes(fill = value)) +
  geom_text(aes(label = round(value, 2))) +
  scale_fill_gradient(low = "green3", high = "magenta3") +
  ggtitle("Correlation Matrix Heatmap") +
  xlab("Variable Names") +
  ylab("Variable Names") 
```

```{r}
table(data_categorical$Orientation)
```

```{r fig.height=3, fig.width=5}
table1 <- as.data.frame(table(data_categorical$Orientation))
table1 <- rename(table1, value = Var1, frequency = Freq)

ggplot(data = table1, aes(x = value, y = frequency)) +
  geom_bar(stat = "identity", fill = "green3")
```
```{r}
table(data_categorical$`Glazing Area Distribution`)

```
```{r fig.height=3, fig.width=5}
table2 <- as.data.frame(table(data_categorical$`Glazing Area Distribution`))
table2 <- rename(table2, value = Var1, frequency = Freq)

ggplot(data = table2, aes(x = value, y = frequency)) +
  geom_bar(stat = "identity", fill = "green3")
```

```{r}
plotData <- select(data, `Cooling Load`, `Orientation`)

ggplot(plotData, aes(x = `Cooling Load`, fill = `Orientation`)) +
  geom_histogram(binwidth = 2.5) +
  facet_grid(~ Orientation)
```


```{r fig.height=5, fig.width=9}
plotData <- select(data, `Cooling Load`, `Glazing Area Distribution`)

ggplot(plotData, aes(x = `Cooling Load`, fill = `Glazing Area Distribution`)) +
  geom_histogram(binwidth = 2.5) +
  facet_grid(~ `Glazing Area Distribution`)
```





