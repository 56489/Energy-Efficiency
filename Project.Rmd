---
title: "Capstone Project CKME 136"
author: 'Student: Walter Cios; Student ID 500791945'
output:
  word_document: default
  html_document: default
---


# Introduction

...

# Step 1: Data Cleaning and Preparation

- Load the package to read the raw data from Excel;
- load also ggplot2 for graphs; 
- load dplyr for applying transformations on the dataframes; 
- load package GGally to be used for plotting

```{r message = FALSE, warning = FALSE}
library(readxl)
library(ggplot2)
library(dplyr)
library(GGally)
library(reshape2)
```

### Loading the data 

After examining the original excel file, I noticed that only the first sheet had data, so I will only read
that from the file

```{r}
raw_data <- read_excel("./Data/ENB2012_data.xlsx", sheet = 1)
```

### Display structure of "raw_data"
I reviewed that all 768 observations are loaded

```{r}
str(raw_data)
```
### Check for NA in the whole dataset and found none 
....

```{r}
sum(sapply(raw_data, is.na))
```

As an alternative we could also have done an NA check per columns and as expected found none 

```{r}
sapply(raw_data, function(x) { sum(is.na(x)) })
```
### Change column name to real variable names 

....
```{r}
data <- raw_data
names(data) <- c("Relative Compactness", "Surface Area", "Wall Area", "Roof Area", "Overall Height",
                 "Orientation", "Glazing Area", "Glazing Area Distribution", "Heating Load", "Cooling Load")
```

## Converting categorical variables to factors

As per the dataset description the variable "Orientation" has only four values N,W,S,E 
The variable "Glazing Area Distribution"" has also the above and in addition "0" and "1"


```{r}
toCategorical <- Vectorize(function(column) {
  switch(as.character(column),
                      "0" = "No Glazing Area",
                      "1" = "Uniform",
                      "2" = "North",
                      "3" = "East",
                      "4" = "South",
                      "5" = "West",
                      NA)
})

data$`Glazing Area Distribution` <- as.factor(toCategorical(data$`Glazing Area Distribution`))
data$Orientation <- as.factor(toCategorical(data$Orientation))

```

## Review again structure, this time for "data"

```{r}
summary(data)
```

From the summmary we can see that Orientation and Glazing Area Distribution, are qualitative-categorical variables, the other variables are quantitaive-continuous


# Step 2: Exploratory Data Analysis 

Split up categorical variables from the continuous ones, into a new dataframe "data_categorical and keep the continuos ones in "data_numerical"

```{r}
data_numeric <- select(data, -Orientation, -`Glazing Area Distribution`)
data_categorical <- select(data, Orientation, `Glazing Area Distribution`)
```

## Paired Scatterplots

I looked for a better display of plot and found the package "GGally" that is being used for scatterplots between all pairs of variables 

```{r fig.height=10, fig.width=10}
ggpairs(data_numeric)
```



## Outlier detection
Review if there are outliers by using boxplots.Going forward I will try to use only ggplot for all graphs to create an consistent view

Looking at the Excel Table "Variable Review for Analysis" that has the min and Max 

```{r}
small <-select (data_numeric,`Relative Compactness`,`Glazing Area`)

large <-select (data_numeric,`Surface Area`,`Roof Area`,`Wall Area`)

medium <-select (data_numeric,`Overall Height`,`Heating Load`,`Cooling Load`)
```

```{r message=F}
small_long <- melt(small)
ggplot(data=small_long, aes(x = variable, y = value)) +
  geom_boxplot(fill = "green") +
  geom_point() +
  ggtitle("Boxplots of variables with small values") +
  xlab("Variable Name") +
  ylab("Values")
```
```{r message=F}
medium_long <- melt(medium)

ggplot(data=medium_long, aes(x = variable, y = value)) +
  geom_boxplot(fill = "green") +
  geom_point() +
  ggtitle("Boxplots of variables with medium values") +
  xlab("Variable Name") +
  ylab("Values")
```

```{r message=F}
# Step 2 
large_long <- melt(large)

ggplot(data=large_long, aes(x = variable, y = value)) +
  geom_boxplot(fill = "green") +
  geom_point() +
  ggtitle("Boxplots of variables with large values") +
  xlab("Variable Name") +
  ylab("Values")
```

```{r fig.height=8, fig.width=10}
correlationMatrix <- cor(data_numeric, method = "pearson")
correlationsLong <- melt(correlationMatrix)

ggplot(data = correlationsLong, aes(x = Var1, y = Var2)) +
  geom_tile(aes(fill = value)) +
  geom_text(aes(label = round(value, 2))) +
  scale_fill_gradient(low = "yellow", high = "green") +
  ggtitle("Correlation Matrix Heatmap") +
  xlab("Variable Names") +
  ylab("Variable Names") 
```